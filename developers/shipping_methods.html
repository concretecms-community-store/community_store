<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating Shipping Methods | Community Store for Concrete CMS</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="shortcut icon" href="/community_store/favicon.ico">
    <meta name="description" content="An open, free and community developed eCommerce system for Concrete CMS">
    
    <link rel="preload" href="/community_store/assets/css/0.styles.210b493c.css" as="style"><link rel="preload" href="/community_store/assets/js/app.d0caae8c.js" as="script"><link rel="preload" href="/community_store/assets/js/2.735879e8.js" as="script"><link rel="preload" href="/community_store/assets/js/13.44b6ec8f.js" as="script"><link rel="prefetch" href="/community_store/assets/js/10.059049ff.js"><link rel="prefetch" href="/community_store/assets/js/11.dbe13d4f.js"><link rel="prefetch" href="/community_store/assets/js/12.1a7f32eb.js"><link rel="prefetch" href="/community_store/assets/js/14.d2519d7c.js"><link rel="prefetch" href="/community_store/assets/js/15.65a3b47e.js"><link rel="prefetch" href="/community_store/assets/js/16.a1a8f7e5.js"><link rel="prefetch" href="/community_store/assets/js/17.4b33ab04.js"><link rel="prefetch" href="/community_store/assets/js/18.7e359d24.js"><link rel="prefetch" href="/community_store/assets/js/19.97cad2df.js"><link rel="prefetch" href="/community_store/assets/js/20.1c16a354.js"><link rel="prefetch" href="/community_store/assets/js/21.b385848d.js"><link rel="prefetch" href="/community_store/assets/js/22.e9f266ff.js"><link rel="prefetch" href="/community_store/assets/js/23.8713b9c1.js"><link rel="prefetch" href="/community_store/assets/js/24.5d58003a.js"><link rel="prefetch" href="/community_store/assets/js/25.296ddca8.js"><link rel="prefetch" href="/community_store/assets/js/26.d037044a.js"><link rel="prefetch" href="/community_store/assets/js/27.bd753dfe.js"><link rel="prefetch" href="/community_store/assets/js/28.576e241f.js"><link rel="prefetch" href="/community_store/assets/js/29.73b441ca.js"><link rel="prefetch" href="/community_store/assets/js/3.04110345.js"><link rel="prefetch" href="/community_store/assets/js/30.ade6ed2f.js"><link rel="prefetch" href="/community_store/assets/js/31.6031c1fd.js"><link rel="prefetch" href="/community_store/assets/js/32.12da9d1c.js"><link rel="prefetch" href="/community_store/assets/js/4.7d9a7e46.js"><link rel="prefetch" href="/community_store/assets/js/5.e8395133.js"><link rel="prefetch" href="/community_store/assets/js/6.d5f36740.js"><link rel="prefetch" href="/community_store/assets/js/7.e9c65e2e.js"><link rel="prefetch" href="/community_store/assets/js/8.8042820f.js"><link rel="prefetch" href="/community_store/assets/js/9.79037c84.js">
    <link rel="stylesheet" href="/community_store/assets/css/0.styles.210b493c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/community_store/" class="home-link router-link-active"><!----> <span class="site-name">Community Store for Concrete CMS</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/community_store/user-guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/community_store/how-tos/" class="nav-link">
  How-Tos
</a></div><div class="nav-item"><a href="/community_store/developers/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="https://github.com/concretecms-community-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/community_store/user-guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/community_store/how-tos/" class="nav-link">
  How-Tos
</a></div><div class="nav-item"><a href="/community_store/developers/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="https://github.com/concretecms-community-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Developer Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/community_store/developers/" aria-current="page" class="sidebar-link">Customizations</a></li><li><a href="/community_store/developers/attributes.html" class="sidebar-link">Product and Order Attributes</a></li><li><a href="/community_store/developers/events.html" class="sidebar-link">Events</a></li><li><a href="/community_store/developers/shipping_methods.html" aria-current="page" class="active sidebar-link">Creating Shipping Methods</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/community_store/developers/payment_methods.html" class="sidebar-link">Creating Payment Methods</a></li><li><a href="/community_store/developers/cli-commands.html" class="sidebar-link">CLI Commands</a></li><li><a href="/community_store/developers/translations.html" class="sidebar-link">Translations</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="creating-shipping-methods"><a href="#creating-shipping-methods" class="header-anchor">#</a> Creating Shipping Methods</h1> <p>Additional shipping methods can be added to Community Store by installing additional add-ons.</p> <p><a href="https://github.com/concretecms-community-store/community_store_shipping_example" target="_blank" rel="noopener noreferrer">An example package showing how to create Community Store shipping methods is available on github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
Additional shipping methods are also available within the <a href="https://github.com/concretecms-community-store" target="_blank" rel="noopener noreferrer">Community Store project page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and can act as further examples, as can the two built in methods.</p> <p>It is recommended to download the master branch of the example shipping method, change its namespace and use it as a base.</p> <p>A shipping method add-on's structure is as follows:</p> <ul><li>A package, with a package controller.php, used to install the package and install the new Shipping Method</li> <li>A shipping method class that extends <code>ShippingMethodTypeMethod</code>. This class is also a Doctrine entity, so refers to a particular database table to store configuration values.</li> <li>An elements template file, used to display the shipping method's Dashboard form</li></ul> <p>A shipping method class defines the fields required to configure the shipping method and can be as simple or complex as required.
Beyond the saving of the specific fields, there are five required functions in the class:</p> <h3 id="addmethodtypemethod"><a href="#addmethodtypemethod" class="header-anchor">#</a> <code>addMethodTypeMethod</code></h3> <p>Used to initially save the new shipping method. The method is passed <code>$data</code>, which contains the values send from the form defined in the shipping method's dashboard element file.</p> <h3 id="update"><a href="#update" class="header-anchor">#</a> <code>update</code></h3> <p>Used to update the shipping method's configuration. In the example method, note that a private method <code>addOrUpdate</code> is used to simplify saving and updating. It is in this function that the individual configuration items for the method are saved.</p> <h3 id="dashboardform"><a href="#dashboardform" class="header-anchor">#</a> <code>dashboardForm</code></h3> <p>Called when displaying the shipping method's dashboard form, initializing the values sent to the element file</p> <h3 id="iseligible"><a href="#iseligible" class="header-anchor">#</a> <code>isEligible</code></h3> <p>Called to determine whether a shipping method is applicable to the order and should be offered. It simply returns true or false.
This method can contain as much or as little checking as required. For example, it may need to:</p> <p>Fetch the cart's items and fetch details about it:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$shippableItems</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Concrete<span class="token punctuation">\</span>Package<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Src<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Cart<span class="token punctuation">\</span>Cart</span><span class="token operator">::</span><span class="token function">getShippableItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$shippableItems</span> <span class="token keyword">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'product'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$totalProductWeight</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token variable">$item</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'product'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'qty'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Check the customer's shipping country:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Concrete<span class="token punctuation">\</span>Package<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Src<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Customer<span class="token punctuation">\</span>Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$custCountry</span> <span class="token operator">=</span> <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shipping_address'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">country</span><span class="token punctuation">;</span>
</code></pre></div><p>Check the cart's subtotal:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$subtotal</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Concrete<span class="token punctuation">\</span>Package<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Src<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Utilities<span class="token punctuation">\</span>Calculator</span><span class="token operator">::</span><span class="token function">getSubTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Check the cart's weight:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$totalWeight</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Concrete<span class="token punctuation">\</span>Package<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Src<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Cart<span class="token punctuation">\</span>Cart</span><span class="token operator">::</span><span class="token function">getCartWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="getoffers"><a href="#getoffers" class="header-anchor">#</a> <code>getOffers</code></h3> <p>This is called once the <code>isEligible</code> function returns true, and returns one ore more 'offers' - each offer being a specific type of shipping and rate.
A shipping method may return more than one offer at time, such as to offer different delivery classes, such as 'express' shipping versus regular shipping.</p> <p>Offers are created and returned within the function as per the following example:</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token comment">// at top of class:</span>
    <span class="token keyword">use</span> <span class="token package">Concrete<span class="token punctuation">\</span>Package<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Src<span class="token punctuation">\</span>CommunityStore<span class="token punctuation">\</span>Shipping<span class="token punctuation">\</span>Method<span class="token punctuation">\</span>ShippingMethodOffer</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">getOffers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$offers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// for each sub-rate, create a ShippingMethodOffer</span>
    <span class="token variable">$offer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShippingMethodOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// then set the rate</span>
    <span class="token variable">$offer</span><span class="token operator">-&gt;</span><span class="token function">setRate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10 is an example, this would be calculated</span>
    
    <span class="token comment">// then set a label for it</span>
    <span class="token variable">$offer</span><span class="token operator">-&gt;</span><span class="token function">setOfferLabel</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'First Offer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// add it to the array</span>
    <span class="token variable">$offers</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$offer</span><span class="token punctuation">;</span>
    
    <span class="token comment">// continue adding further rates</span>
    <span class="token variable">$offer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShippingMethodOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$offer</span><span class="token operator">-&gt;</span><span class="token function">setRate</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$offer</span><span class="token operator">-&gt;</span><span class="token function">setOfferLabel</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Second Offer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// further text details for the specific offer can be added via:</span>
    <span class="token variable">$offer</span><span class="token operator">-&gt;</span><span class="token function">setOfferDetails</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Signature required on delivery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token variable">$offers</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$offer</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$offers</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/community_store/developers/events.html" class="prev">
        Events
      </a></span> <span class="next"><a href="/community_store/developers/payment_methods.html">
        Creating Payment Methods
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/community_store/assets/js/app.d0caae8c.js" defer></script><script src="/community_store/assets/js/2.735879e8.js" defer></script><script src="/community_store/assets/js/13.44b6ec8f.js" defer></script>
  </body>
</html>
